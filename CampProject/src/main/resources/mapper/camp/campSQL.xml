<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="camp">
	<select id="selectList" parameterType="map" resultType="camp">		
		select
    		rnum,
    		campNo,
   			campName,
    		campAddr,
    		memberNo,
    		campShow,
    		campType,
    		campPh,
    		campPeriod,
    		campDay,
    		campFacility
			from
        		(select rownum as rnum, n.*
		from
		(select
			camp_no as campNo,
			camp_name as campName,
			camp_addr as campAddr,
			member_no as memberNo,
			camp_show as campShow,
			camp_type as campType,
			camp_ph as campPh,
			camp_period as campPeriod,
			camp_day as campDay,
			camp_facility as campFacility
		from camp order by 1 desc)
		n)
           where rnum between #{start} and #{end}
	</select>
	<select id="totalCount" resultType="_int">
		select count(camp_no) as cnt from camp
	</select>
	<select id="selectOne" parameterType="camp" resultType="camp">
		select 
          	camp_no as campNo,
			camp_name as campName,
			camp_addr as campAddr,
			member_no as memberNo,
			camp_show as campShow,
			camp_type as campType,
			camp_ph as campPh,
			camp_period as campPeriod,
			camp_day as campDay,
			camp_facility as campFacility
        from camp 
        <trim prefix="where" prefixOverrides="and|or">
		  	<if test="campNo != 0">
				 camp_no=#{campNo}
		  	</if>		  	
		  </trim>
	</select>
	<select id="selectPictureList" parameterType="map" resultType="campPicture">
		select
			pict_no as pictNo,
			camp_no as campNo,
			filename ,
			filepath ,
			filegrade 
		from camp_picture
		<trim prefix="where" prefixOverrides="and|or">
		  	<if test="campNo != 0">
				 camp_no=#{campNo}
		  	</if>
		  	<if test="filegrade != 0">
		  		and filegrade = #{filegrade}
		  	</if>  	
		  </trim>
	</select>
	<select id="selectCamp" parameterType="camp" resultType="camp">
	select
    		camp_no as campNo,
			camp_name as campName,
			camp_addr as campAddr,
			member_no as memberNo,
			camp_show as campShow,
			camp_type as campType,
			camp_ph as campPh,
			camp_period as campPeriod,
			camp_day as campDay,
			camp_facility as campFacility
			from
			camp
			<trim prefix="where" prefixOverrides="and|or">
			  	<if test="campNo != 0">
					 camp_no=#{campNo}
			  	</if>
			  	<if test="memberNo != 0">
		  		and member_No = #{memberNo}
		  		</if> 
		  	</trim>
	</select>
	
	
	<select id="selectSiteList" parameterType="site" resultType="site">
		select
			*
		from site
		<trim prefix="where" prefixOverrides="and|or">
		  	<if test="campNo != 0">
				 camp_no=#{campNo}
		  	</if>
		  	<if test="reserveDate != null">
		  		and reserve_date = #{reserveDate}
		  	</if>  	
		  </trim>
	</select>
	<select id="reserveTotalCount" parameterType="site" resultType="_int">
		select 
			count(distinct site_name) 
		from site
		<trim prefix="where" prefixOverrides="and|or">
			<if test="campNo != 0">
				 camp_no=#{campNo}
		  	</if>
		</trim>
	</select>
	<delete id="deleteCamp" parameterType="_int">
		delete from camp where camp_no=#{_parameter}
	</delete>
	<insert id="insertCamp" parameterType="camp">
		insert into camp values(camp_seq.nextval,#{campName},#{campAddr},#{memberNo},#{campShow},#{campType},#{campPh},#{campPeriod},#{campDay},#{campFacility})
	</insert>
	<select id="selectLastCamp" resultType="_int">
		select 
			camp_No
		from camp where camp_No=(
	    select 
	        max(camp_No) 
	    from camp
	    )
	</select>
	<insert id="insertCampPicture" parameterType="campPicture">
		insert into camp_picture values(camp_picture_seq_2.nextval,#{campNo},#{filename},#{filepath},#{fileGrade})
	</insert>
	<delete id="deleteCampPicture" parameterType="_int">
		delete from camp_picture where camp_no = #{_parameter}
	</delete>
</mapper>
